<h1><%= @event.name %> documents</h1>
<div class="admin-header">
  <%= form_tag(upload_admin_event_documents_url(@event), multipart: true, remote: true, class: 'form-horizontal')  do %>
    <%= hidden_field_tag "event", @event.id %>
    <div class="control-group">
      <label for="language_id" class="control-label">Language</label>
      <div class="controls">
        <%= select_tag :language_id,
          options_for_select(
            @languages.map { |l| [l.name, l.id] },
            @english.id
          )
        %>
      </div>
    </div>
    <div class="control-group">
      <label for="date" class="control-label">Date</label>
      <div class="controls">
        <%= text_field_tag :date, @event.effective_at_formatted, :class => "datepicker" %>
      </div>
    </div>
    <div class="control-group">
      <label for="is_public" class="control-label">Is public</label>
      <div class="controls">
        <%= check_box_tag :is_public %>
      </div>
    </div>
    <div class="control-group">
      <label for="files" class="control-label">Documents to Upload</label>
      <div class="controls">
        <%= file_field_tag "files[]", multiple: true, id: 'files' %>
        <ul id="list"></ul>
      </div>
    </div>
    <div class="control-group">
      <div class="controls">
        <%= submit_tag 'Upload', class: 'btn btn-primary' %>
      </div>
    </div>
  <% end %>
</div>

<%= admin_new_modal{ '' } %>

<%= admin_table %>

<%= paginate collection %>

<script type="text/javascript">

$(function() {

  // This should be passed by rails
  var document_types = [['type1', 'type 1'], ['type2', 'type 2']];

  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    // files is a FileList of File objects. List some properties.
    var output = [];
    var doc_type_select;

    for (var i = 0, f; f = files[i]; i++) {
      doc_type_select = '<select name="'+f.name+'">';
      document_types.forEach(function (t) {
        doc_type_select += '<option value="'+t[0]+'">'+t[1]+'</option>';
      });
      doc_type_select += '</select>';
      output.push('<li>'+escape(f.name),
                  doc_type_select+'</li>');
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }

  // Check for the various File API support.
  if (window.File && window.FileReader && window.FileList && window.Blob) {
    document.getElementById('files').addEventListener('change', handleFileSelect, false);
  } else {
    //alert('The File APIs are not fully supported in this browser.');
  }
});
</script>
