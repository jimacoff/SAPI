<div class="admin-header">
  <div class="row-fluid">
    <h3><%= @event.name %></h3>
    <div class="row-fluid">
      <div class="span12">

      <%= form_tag(upload_admin_event_documents_url(@event), multipart: true, remote: true, class: 'documents')  do %>
        <div class="row-fluid">
          <label for="language">Language</label>
          <%= select_tag "language", options_for_select([["English", "English"]]), :prompt => "Select something" %>
          </div>
        <div class="row-fluid">
          <label for="is_public">Is public</label>
          <%= check_box_tag 'is_public' %>
        </div>
        <div class="row-fluid">
          <label for="files">Documents to Upload</label>
          <%= file_field_tag "files[]", multiple: true, id: 'files' %>
          <ul id="list"></ul>
        </div>
        <%= hidden_field_tag "event", @event.id %>
        <div class="row-fluid">
          <%= submit_tag 'upload', class: 'btn' %>
        </div>
      <% end %>

      </div>
    </div>
  </div>
</div>

<h2>Uploaded so far:</h2>
<ul>
<% @event.documents.each do |d| %>
  <li> <%= d.filename %> </li>
<% end %>
</ul>

<script type="text/javascript">

$(function() {

  // This should be passed by rails
  var document_types = [['type1', 'type 1'], ['type2', 'type 2']];

  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    // files is a FileList of File objects. List some properties.
    var output = [];
    var doc_type_select;

    for (var i = 0, f; f = files[i]; i++) {
      doc_type_select = '<select name="'+f.name+'">';
      document_types.forEach(function (t) {
        doc_type_select += '<option value="'+t[0]+'">'+t[1]+'</option>';
      });
      doc_type_select += '</select>';
      output.push('<li>'+escape(f.name),
                  doc_type_select+'</li>');
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }

  // Check for the various File API support.
  if (window.File && window.FileReader && window.FileList && window.Blob) {
    document.getElementById('files').addEventListener('change', handleFileSelect, false);
  } else {
    //alert('The File APIs are not fully supported in this browser.');
  }
});
</script>
